<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Book Alchemy</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  </head>
  <body>

    <header>
      <h1>📚 Book Alchemy</h1>
      <p>Discover, manage, and expand your magical world of books ✨</p>
    </header>

    <!-- Button Section -->
    <div class="button-container">
      <a href="/add_book"><button class="btn btn-primary">➕ Add New Book</button></a>
      <a href="/add_author"><button class="btn btn-secondary">👤 Add New Author</button></a>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul>
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <!-- Search Form -->
    <form method="get" action="/" class="search-form">
      <label for="search">🔎 Search:</label>
      <input type="text" id="search" name="search" placeholder="Search title" value="{{ request.args.get('search', '') }}">
      <button type="submit" class="btn btn-success">Search</button>
    </form>

    <!-- Sort Form -->
    <form method="get" action="/" class="sort-form">
      <label for="sort_by">📍 Sort by:</label>
      <select name="sort" id="sort_by" onchange="this.form.submit()">
        <option value="">-- Choose --</option>
        <option value="title_asc">Title A–Z</option>
        <option value="title_desc">Title Z–A</option>
        <option value="author_asc">Author A–Z</option>
        <option value="author_desc">Author Z–A</option>
      </select>
    </form>

    <!-- Book List -->
    {% for book in books %}
      <div class="book-card">
        <h3>{{ book.title }}</h3>
        <p>Author: {{ book.author.name }}</p>

        <form action="/book/{{ book.id }}/delete" method="post">
          <button type="submit" onclick="return confirm('Do you really want to delete this book?')">🗑️ Delete</button>
        </form>

        {% if book.isbn %}
          <img src="https://covers.openlibrary.org/b/isbn/{{ book.isbn }}-M.jpg" alt="Cover for {{ book.title }}">
        {% else %}
          <p>No cover available</p>
        {% endif %}
      </div>
    {% endfor %}

    <footer>
      <p>✨ Book Alchemy © 2025 – A World Full of Imagination ✨</p>
    </footer>

  </body>
</html>